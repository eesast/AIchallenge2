[TOC]

# 队式20

<!--游戏名未定，暂用队式20称呼游戏，后面定名字了直接全部替换即可，另外后面有未明确指出的待定内容都用这样的注释法写-->

## 一、总述

整个地图基于模仿吃鸡的模式，故事背景暂定，一些细节名字有待修正，本文档暂时(2018/8/3)只作概念、宏观上的规定。所有参赛队伍将同时被随机投放到地图各处，在地图上寻找装备、补给等，经过战斗直到只剩下一支队伍作为冠军。

本游戏采用细分像素的表示法，一个人物将是由多个像素表示成的近圆形，每个东西都应当由多个像素组成，地图大小为$m*n$（待定），但是整个地图不必作为数据进行传输，可以单处理局部地图数据。游戏将以帧作为回合界限（即调用玩家AI的频率），并以<!--每秒20帧（20fps）-->的速度进行。

## 二、规则

### (1)指令

玩家的指令接口包括**移动**、**调整**、**攻击**、**整理**、**待命**、**拾取**、**无线电**。指令有**优先级**与**CD**，一个指令可能需要不止一帧的时间来完成，这个完成所用帧数即是CD值，<u>CD期间只有更高级的指令可以打断它</u>，优先级则是一个用来比较指令优先度的非负整数，<u>数值越大的指令优先级越高</u>，玩家需要分析局面，合理发送指令来博取优势、取得胜利。发送一次指令时，需要指明指令名、给定该指令的相关参数，以指令名为索引，无用参数将被无视，无效指令也将被无视，具体指令解释如下：

#### a.移动

- [ ] ##### 简介

玩家的移动方向将由角度指令决定，**移动速度**指一次移动指令后若不被打断玩家移动的距离，**移动速度上限**与当前**负重**与**状态**有关，具体公式为<!--待填坑-->，玩家可以在允许范围内自行决定本次移动的速度。

- [ ] #####指令参数

1. 移动角度：一个`float`量，应当不小于**-180**且不超过**180**，计算方法是相对视线逆时针的角度
2. 移动速度：一个`int`量，应当不超过**移动速度上限**且不低于**移动速度下限**<!--（100）-->，当取值范围为空集时即不可移动

#### b.调整

- [x] ##### 简介

调整指调整玩家当前的**视线**与**状态**，后者分为**站立**、**蹲下**、**趴下**三种。站立为常规姿势，蹲下时根据地形玩家被命中的机率将下降，但同时移动速度也会下降，趴下时根据地形玩家被命中或发现的几率将下降，但同时无法移动。视线调整指玩家面向的方向，包含一个角度参数，计算方法与移动一样，使用缺省参数可以不改变视线/状态。

- [x] ##### 指令参数
1. 状态：一个`int`（宏）量（`STATE_STAND/STATE_SQUAT/STATE_DOWN`），指代新的状态
2. 视线：一个`float`量，应当不小于**-180**且不超过**180**，计算方法是相对视线逆时针的角度

#### c.攻击

- [x] ##### 简介

发送攻击指令后将使用**在持武器**朝指定方位进行攻击，攻击方式由武器决定。普通的武器只能指定攻击角度，特殊武器附带有一些独特参数，指定无法使用的参数将被无视（比如说使用手枪时指定攻击距离）。

- [x] ##### 指令参数


1. 攻击角度：一个`float`量，取值范围为视角范围（即攻击视角之外区域必须先使用调整指令转身），计算方法是相对视角逆时针的角度
2. 攻击距离：一个`unsigned int`量，对于可以指定攻击距离的武器进行攻击距离指定，应当不超过武器的**射程**，超过则自动截取为最大距离（但依然是有效指令）
3. 攻击方式：一个`int`（宏）量，只对部分特殊武器生效，将在武器部分一一罗列。

#### d.整理

- [x] ##### 简介

该指令将用于整理玩家**装备**、**装备配件**、**道具**等，包括将一个装备配件转移到另一个装备上，将物品**丢弃**或**摧毁**，切换主武器，这些操作都由整理指令发出，指令将声明目标物品的ID，（可能用到的）另一个物品ID，行为。

- [ ] ##### 指令参数


1. 物品1ID：一个`unsigned int`量，指明操作对象的物品ID
2. 物品2ID：一个`unsigned int`量，指明另一个操作对象（如果需要的话）的物品ID，缺省值为<!--待定-->
3. 行为：一个`int`（宏）量，分别为`TIDY_CHANGE`（改变配件位置）、`TIDY_EXCHANGE`（切换主武器）、`TIDY_DISCARD`（丢弃物品）、`TIDY_DISTROY`（摧毁物品）<!--待补充-->


#### e.待命

- [x] ##### 简介

待命是一个打断性指令，将试图中止一切可能中止的指令，恢复到站立状态，如果不指定角度将面朝原来的角度，或者制定角度以将视线改为目标方向。

- [x] ##### 指令参数


3. 方向：一个`float`量，应当不小于**-180**且不超过**180**，计算方法是相对视线逆时针的角度，缺省值为0

#### f.拾取

- [x] ##### 简介

当玩家感知范围内有可拾取的物品时，可以通过发送拾取指令来捡起目标物品，需要指定物品ID，并且由于不同物品可能支持拾取后以不同方式存储，因此还应指定**拾取方式**，拾取本身无CD，但是某些特定拾取方式可能会产生CD，这将在具体物品介绍部分列出。不合法的拾取指令将被无视，同一回合内不同玩家拾取同一物品将随即决定一个人拾取成功。

- [x] ##### 指令参数


1. 物品ID：一个`unsigned int`量，指明操作对象的物品ID
2. 方式：一个`int`（宏）量，表明拾取时对物品做的一些操作，具体宏将在相应物品部分列出。

####g.无线电

- [ ] ##### 简介

无线电指令是本游戏团队合作的精髓，无线电消息为一个32位整数，玩家将通过无线电给队友发送信息，并通过接收队友传来的信息进行决策与团队合作，内容所指定的含义由玩家队伍自行商议决策，本指令应指明接受消息的队友ID，消息，接受者将会通过**听觉**得到**消息**、**发送者**的ID以及**时延**。应注意发送无线电的过程是瞬间完成的，但是无线电将以<!--3000/帧-->的速度传播，因此到达接收者处将需要经历一定帧数，这个帧数称作时延，玩家将需要用时延估算距离。

<!--注释：由于消息机制内部讨论时多次修改，可能有些地方没能更新到最新版，如果发现此部分文档逻辑矛盾或不清晰处请联系本人--饶淙元2018/8/4 14:59-->

- [ ] ##### 指令参数


1. 目标ID：一个`unsigned int`量，表示目标的ID。另外通信兵有额外参数，在通信兵处给出。
2. 消息：一个`unsigned char/int`量，作为发送的消息传出，消息所表示的意义需要玩家自行商议。注：此处提供两种消息发送模式，一种是纯粹由玩家自定义的32位整数消息，接收者将直接对这个32位整数进行处理，一种是封装好的简洁接口（萌新友好型），简洁接口中将自动将坐标信息发送者HP等信息打包发送过去，玩家自定义信息只是一个`unsigned char`（即至多256种消息），解包时也只需要调用相关接口即可自动获取相应消息。关于两种接口的具体内容在 *三、选手接口* 中给出。

#### 附表:指令CD与优先级

|  指令  |  CD  | 优先级 |
| :----: | :--: | :----: |
|  移动  |      |        |
|  调整  |      |        |
|  攻击  |      |        |
|  整理  |      |        |
|  待命  |  0   |        |
|  拾取  |  0   |        |
| 无线电 |  0   |        |



### (2)感知

#### a.视觉

视觉是获取游戏信息的主要途径，玩家始终有三个关于重要视觉的重要变量:**视线**、**视角**和**视距**玩家的视野为一个扇形区域，视线即扇形的中心线，扇形区域将沿中心线顺逆时针各转视角的半角，我们将视觉可以获取信息的地方称作**视野范围**，具体来说可以参考下图（俯视图）:

![vision](.\vision.jpg)

图中的direction所给定的红线就是视线，β=180°就是视角（仅举例，实际参数未必是这么多），红色线段的长度，也即扇形半径，既是视距，而图中的粉色区域与绿色区域的并集就是视野范围。需要注意的是游戏给出的信息仅仅是视野范围内可获取的信息，但是可能会遇到障碍物，比如上图中我们假设x正半轴上有一堵高墙，那么绿色范围的信息玩家不可获取，此时玩家只能获取到x正半轴上有一堵墙，<u>如果试图获取绿色区域信息得到的反馈将<!--是空地而不是盲区--></u>！

在实际游戏中通常只有视线是玩家可以自行决定的，视角和视距都由玩家的**英雄**、**物品**、所处**地形**等决定，玩家只能获取这些参数而不能改变。

#### b.听觉

视觉作为主要信息获取途径，通常是玩家主动获取，而听觉则是一个被动获取信息的过程。游戏中的听觉信息主要分为两大类：**环境声音**与**无线电**。获取到的听觉信息会放到一个队列里，如果没有及时获取，则会在下一帧里自动清空。环境声音将有显著的特征来便于玩家区分，玩家理应每回合将听觉信息遍历一遍并做出判断。所有的声音信息均包括**消息**、**发送者**和**时延**，其中消息是一个`int`型变量承载消息所含的信息，发送者是一个`unsigned int`作为信源ID，时延是一个<!--times-->型变量告诉接收者这则消息距离发送过去了多少帧。听觉相关特征如下：

1. 环境声音：信源ID<!--为-1（即0xffffffff或4294967295）-->，消息中<!--此处规定编码方式以决定声源角度与声音类型-->。
2. 无线电：信源ID为队友ID，消息的含义自定义（两种接口），玩家需要内部商议。

附表：不同声音的发出时机与宏

| 声音类型    | 发出时机                     | 传播距离<!--待定--> | 宏<!--待定--> |
| ----------- | :--------------------------- | ------------------- | ------------- |
| 脚步声      | 移动速度大于<!--150-->时发出 |                     |               |
| 出膛声      | 普通枪子弹出膛时发出         |                     |               |
| 狙击声      | 狙击枪子弹出膛时             |                     |               |
| 机器声      | 电子设备时工作时发出         |                     |               |
| 水声        | 水流持续发出                 |                     |               |
| 中弹声      | 玩家中弹时发出               |                     |               |
| 锤声        | 玩家挥动虎涛锤时发出         |                     |               |
| 爆炸声      | 手雷、普通炮弹炸裂时         |                     |               |
| 闪光弹声    | 闪光弹炸裂时发出             |                     |               |
| 烟雾弹声    | 烟雾弹炸裂时发出             |                     |               |
| 电磁声      | 电磁炮弹炸裂时发出           |                     |               |
|             |                              |                     |               |
|             |                              |                     |               |
| <!--待续--> |                              |                     |               |



### (3)物品

物品是对游戏中各类可获取、可使用物的一个统称，细分可分为**装备**、**道具**、**配件**。其中，不同的物品属性决定了一个物品的基本特征，而同类物品又有各自独特的属性，这里将详细列出。

#### a.整体特征

- 装备：可以从穿戴的物品，装备均有一个值（**耐久度**）来衡量其使用程度，当耐久度为0时装备将损坏，表现方式为该装备永久消失，一般情况下装备无法修补。装备又可以分为防具和武器，具体说来防具的耐久度即为防具的磨损度，武器的耐久度则是指子弹数（特别的，近战武器也有类似的概念），且防具穿戴后将直接生效，遭受攻击时视情况损失耐久度，武器穿戴后即表现为**在持武器**。
- 道具：一次性使用的物品，该部分物品通常为小件道具，应对特殊情况。
- 配件：属于辅助性物品，主要用于强化一些装备，该类型物品不可摧毁，无耐久度，可指定安装配件的装备，配件只有被安装后才能生效。

#### b.枚举

<!--这口大锅暑假结束都不一定能写完，这里先给一个模板，希望逻辑组的朋友没事儿了帮忙写写（虽然我也知道可能说这句话只是个心理安慰orz）-->

##### 1.虎涛锤

简介：游戏里唯一的近战武器，杀伤力极强，阴人神器，但是强大的力量不是凡人可以驾驭，普通人使用它时攻击速度极慢。

类型：装备-武器

耐久度：<!--100-->

攻击距离：<!--100（这个显然与我们规定的人物半径有关）-->

攻击CD：20帧

伤害：<!--80-->

重量：<!--100-->

特性：挥动时移动速度下降50%

### (4)地形

### (5)人物信息

人物信息指的玩家可以获取的关于自己的全部信息，包括：**HP**、**移动速度上限**、**移动速度**、**状态**、**负重**、**视线**、**视距**、**视角**、**坐标**、**在持武器**、**防具**、**背包**。以下给出这些信息的概念，可见/不可见指其他人能否通过视觉感知到这些信息，需要注意的是可见性对敌人和队友没有差异，需要向队友透露特别信息可用无线电来完成。

- HP：Heal Point，血量，该值一个0到100之间的整数，受到伤害后会降低，降至0时人物死亡。除0外不可见。
- 移动速度上限/移动速度/状态：见 *(1)指令* 。移动速度上限不可见，移动速度与状态可见
- 负重：指玩家携带所有物品重量之和（不包括行动在外的电子设备）。不可见
- 视线/视距/视角：见  *(2)感知*  。视线可见，视距与视角不可见。
- 坐标：即玩家中心所处的坐标，这里需要指出的是玩家在假想的二维地图上所占据的点并不止一个，但是形状为圆形，此处给出的是圆心坐标。可见。
- 在持武器/防具：见 *(3)物品* 。可见。
- 背包：存放玩家所有未穿戴物品的集合，没有上限，但是当负重过大时会出现无法移动的惨状。生前不可见，死亡后近距离<!--（100以内）-->可见。

### (*6*)英雄

### (7)胜利判定

## 三、选手接口